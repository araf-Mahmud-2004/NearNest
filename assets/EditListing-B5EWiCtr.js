import{j as e}from"./ui-JykPZCXU.js";import{r as d}from"./vendor-o8UMtg5z.js";import{B as u,I as h}from"./input-CIthbtd8.js";import{C as P,b as U,c as k,a as F}from"./card-nPJQNN0C.js";import{T}from"./textarea-BzGSuOd9.js";import{S as A,a as B,b as R,c as G,d as V}from"./select-BAwiIVOJ.js";import{N as y,e as N}from"./Navbar-BlvArtp8.js";import{u as _,d as q,X as z,e as b}from"./index-DFAoHlto.js";import{a as H,c as J}from"./router-DZ6VJzti.js";import{A as M}from"./arrow-left-CVV2LaX8.js";import{U as O}from"./upload-C1Lik6jl.js";import"./index-BdQq_4o_.js";import"./supabase-BdK7WG9U.js";import"./utils-Bsf8JV-l.js";const oe=()=>{const l=H(),{id:n}=J(),{toast:r}=_(),{updateListing:C}=q(),[E,f]=d.useState(!0),[g,j]=d.useState(!1),[a,v]=d.useState({title:"",description:"",price:"",category:"",location:""}),[p,x]=d.useState([]),S=["Electronics","Furniture","Clothing","Books","Sports","Other"];d.useEffect(()=>{(async()=>{if(!n){r({title:"Error",description:"No listing ID provided",variant:"destructive"}),l("/listings");return}try{f(!0);const{data:s}=await b.getListings(),i=s?.find(m=>m.id===n);if(!i){r({title:"Error",description:"Listing not found",variant:"destructive"}),l("/listings");return}const{data:o}=await b.getCurrentUserProfile();if(i.user_id!==o?.id){r({title:"Error",description:"You can only edit your own listings",variant:"destructive"}),l("/listings");return}v({title:i.title,description:i.description,price:i.price.toString(),category:i.category,location:i.location}),i.image&&x([i.image])}catch(s){console.error("Error loading listing:",s),r({title:"Error",description:"Failed to load listing",variant:"destructive"}),l("/listings")}finally{f(!1)}})()},[n,l,r]);const c=(t,s)=>{v(i=>({...i,[t]:s}))},L=t=>{const s=t.target.files;s&&Array.from(s).forEach(i=>{const o=new FileReader;o.onload=m=>{m.target?.result&&x(I=>[...I,m.target.result])},o.readAsDataURL(i)})},w=t=>{x(s=>s.filter((i,o)=>o!==t))},D=async t=>{if(t.preventDefault(),!a.title||!a.description||!a.price||!a.category){r({title:"Error",description:"Please fill in all required fields.",variant:"destructive"});return}if(!n){r({title:"Error",description:"No listing ID provided",variant:"destructive"});return}try{j(!0),await C(n,{title:a.title,description:a.description,price:Number(a.price),category:a.category,location:a.location||"Local Area",image:p[0]||null}),r({title:"Success",description:"Listing updated successfully"}),l("/listings")}catch(s){console.error("Error updating listing:",s),r({title:"Error",description:"Failed to update listing",variant:"destructive"})}finally{j(!1)}};return E?e.jsxs("div",{className:"min-h-screen bg-background text-foreground",children:[e.jsx(y,{}),e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(N,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading listing..."})]})]}):e.jsxs("div",{className:"min-h-screen bg-background text-foreground",children:[e.jsx(y,{}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8 animate-fade-in",children:[e.jsxs(u,{variant:"ghost",onClick:()=>l(-1),className:"mb-4 hover:bg-gray-100",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Edit Listing"}),e.jsx("p",{className:"text-muted-foreground",children:"Update your listing details"})]}),e.jsxs(P,{className:"border-0 shadow-md animate-fade-in",style:{animationDelay:"0.1s"},children:[e.jsx(U,{children:e.jsx(k,{children:"Listing Details"})}),e.jsx(F,{children:e.jsxs("form",{onSubmit:D,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Title *"}),e.jsx(h,{placeholder:"Enter item title",value:a.title,onChange:t=>c("title",t.target.value),className:"transition-all duration-200 focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Price *"}),e.jsx(h,{type:"number",placeholder:"0",value:a.price,onChange:t=>c("price",t.target.value),className:"transition-all duration-200 focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Category *"}),e.jsxs(A,{value:a.category,onValueChange:t=>c("category",t),children:[e.jsx(B,{className:"transition-all duration-200 focus:ring-2 focus:ring-primary",children:e.jsx(R,{placeholder:"Select category"})}),e.jsx(G,{children:S.map(t=>e.jsx(V,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Location"}),e.jsx(h,{placeholder:"Enter location",value:a.location,onChange:t=>c("location",t.target.value),className:"transition-all duration-200 focus:ring-2 focus:ring-primary"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Description *"}),e.jsx(T,{placeholder:"Describe your item in detail...",value:a.description,onChange:t=>c("description",t.target.value),className:"min-h-32 transition-all duration-200 focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Photos"}),e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center hover:border-primary transition-colors duration-200",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:L,className:"hidden",id:"image-upload"}),e.jsxs("label",{htmlFor:"image-upload",className:"cursor-pointer",children:[e.jsx(O,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Click to upload photos"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"PNG, JPG up to 10MB"})]})]}),p.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:p.map((t,s)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t,alt:`Upload ${s+1}`,className:"w-full h-24 object-cover rounded-lg"}),e.jsx(u,{type:"button",variant:"destructive",size:"sm",className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200 p-1 h-6 w-6",onClick:()=>w(s),children:e.jsx(z,{className:"h-3 w-3"})})]},s))})]}),e.jsxs("div",{className:"flex space-x-4 pt-6",children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>l(-1),className:"flex-1",disabled:g,children:"Cancel"}),e.jsx(u,{type:"submit",className:"flex-1 bg-primary hover:bg-accent text-primary-foreground",disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-4 w-4 mr-2 animate-spin"}),"Updating..."]}):"Update Listing"})]})]})})]})]})]})};export{oe as default};
