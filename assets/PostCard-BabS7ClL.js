import{c as S,s as y,b as P,u as Q}from"./index-DOD6g3cj.js";import{j as e}from"./ui-JykPZCXU.js";import{r as p}from"./vendor-o8UMtg5z.js";import{C as W,a as X,e as re}from"./card-BPC4h2rA.js";import{D as U,f as ne,g as V,h as B,i as H,e as R,A as D,b as $,c as E,I as ie,U as q,M as z,H as L,B as I,j as Z,k as le,a as ce}from"./Navbar-DXhC-Htt.js";import{B as g,I as oe}from"./input-DSoQLqVb.js";import{U as M,E as de}from"./ErrorBoundary-CbkJnSuc.js";import{T as me}from"./textarea-BQPmEDNz.js";import{L as J}from"./label-R1kRSnQb.js";import{u as xe,S as ue,T as he}from"./useMessaging-CuoBxPiu.js";import{a as T}from"./router-DZ6VJzti.js";import{f as F,S as je}from"./timeUtils-BE1il1GG.js";import{M as ee}from"./map-pin-Bk-G5ksk.js";import{C as se}from"./clock-B4dpWcDd.js";import{E as ge}from"./eye-CroIoA9q.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=S("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=S("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=S("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=S("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),k={async checkInterest(a,s,r){const{data:t,error:d}=await y.from("interests").select("*").eq("user_id",a).eq("post_id",s).eq("post_type",r).single();return{data:t,error:d}},async addInterest(a){const{data:s,error:r}=await y.from("interests").insert(a).select().single();return{data:s,error:r}},async removeInterest(a,s,r){const{error:t}=await y.from("interests").delete().eq("user_id",a).eq("post_id",s).eq("post_type",r);return{error:t}},async getPostInterests(a,s){const{data:r,error:t}=await y.from("interests").select(`
        *,
        profiles:user_id (
          id,
          username,
          full_name,
          avatar_url
        )
      `).eq("post_id",a).eq("post_type",s).order("created_at",{ascending:!1});return{data:r,error:t}},async getInterestCount(a,s){const{count:r,error:t}=await y.from("interests").select("*",{count:"exact",head:!0}).eq("post_id",a).eq("post_type",s);return{count:r,error:t}},async createInterestNotification(a,s,r,t,d,c){const u={user_id:a,type:"interest",title:`Someone is interested in your ${t}`,message:`${c} is interested in "${d}"`,data:{post_id:r,post_type:t,post_title:d,interested_user_id:s,interested_user_name:c},read:!1},{data:i,error:o}=await y.from("notifications").insert(u).select().single();return{data:i,error:o}},async toggleInterest(a,s,r,t,d,c){const{data:u}=await this.checkInterest(a,s,r);if(u){const{error:i}=await this.removeInterest(a,s,r);return{isInterested:!1,error:i}}else{const{data:i,error:o}=await this.addInterest({user_id:a,post_id:s,post_type:r});return o?{isInterested:!1,error:o}:(a!==t&&await this.createInterestNotification(t,a,s,r,d,c),{isInterested:!0,error:null})}}},pe=(a,s,r,t)=>{const[d,c]=p.useState(!1),[u,i]=p.useState(0),[o,h]=p.useState(!1),{user:x}=P(),{toast:N}=Q();return p.useEffect(()=>{(async()=>{if(x)try{const{data:n}=await k.checkInterest(x.id,a,s);c(!!n);const{count:f}=await k.getInterestCount(a,s);i(f||0)}catch(n){console.error("Error loading interest data:",n)}})()},[x,a,s]),{isInterested:d,interestCount:u,loading:o,toggleInterest:async()=>{if(!x){N({title:"Authentication Required",description:"Please log in to show interest",variant:"destructive"});return}h(!0);try{const l=x.user_metadata?.full_name||x.email||"Someone",{isInterested:n,error:f}=await k.toggleInterest(x.id,a,s,r,t,l);if(f)throw f;c(n),i(v=>n?v+1:v-1),N({title:n?"Interest Added":"Interest Removed",description:n?`You've shown interest in "${t}"`:`You've removed interest from "${t}"`})}catch(l){console.error("Error toggling interest:",l),N({title:"Error",description:"Failed to update interest. Please try again.",variant:"destructive"})}finally{h(!1)}}}},we=({postId:a,postType:s,postTitle:r,interestCount:t,children:d})=>{const[c,u]=p.useState([]),[i,o]=p.useState(!1),[h,x]=p.useState(!1),N=async()=>{o(!0);try{const{data:l,error:n}=await k.getPostInterests(a,s);l&&u(l)}catch(l){console.error("Error loading interested persons:",l)}finally{o(!1)}};p.useEffect(()=>{h&&N()},[h,a,s]);const m=l=>{const n=new Date,f=new Date(l),v=Math.floor((n.getTime()-f.getTime())/(1e3*60));if(v<1)return"Just now";if(v<60)return`${v}m ago`;const w=Math.floor(v/60);return w<24?`${w}h ago`:`${Math.floor(w/24)}d ago`};return e.jsxs(U,{open:h,onOpenChange:x,children:[e.jsx(ne,{asChild:!0,children:d}),e.jsxs(V,{className:"sm:max-w-lg max-h-[80vh] overflow-y-auto",children:[e.jsxs(B,{children:[e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Interested Persons (",t,")"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:['People who showed interest in "',r,'"']})]}),i?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(R,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2 text-sm text-muted-foreground",children:"Loading..."})]}):c.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(M,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No one has shown interest yet"})]}):e.jsx("div",{className:"space-y-3",children:c.map(l=>{const n=l.profiles;return n?e.jsx(W,{className:"border border-border",children:e.jsx(X,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(D,{className:"h-10 w-10",children:[e.jsx($,{src:n.avatar_url||void 0}),e.jsx(E,{children:(n.full_name||n.username).charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:n.full_name||n.username}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",n.username]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Interested ",m(l.created_at)]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ie,{profile:n,postTitle:r,postType:s,children:e.jsxs(g,{variant:"outline",size:"sm",children:[e.jsx(q,{className:"h-3 w-3 mr-1"}),"View"]})}),e.jsxs(g,{size:"sm",onClick:()=>{alert(`Contact feature coming soon! You can reach out to ${n.full_name||n.username}.`)},children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"Contact"]})]})]})})},l.id):null})}),c.length>0&&e.jsx("div",{className:"mt-4 p-3 bg-muted rounded-lg",children:e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:["ðŸ’¡ Tip: You can contact interested persons to coordinate details about your ",s]})})]})]})},be=({postId:a,postType:s,postOwnerId:r,postTitle:t,variant:d="default",className:c=""})=>{const{user:u}=P(),{isInterested:i,interestCount:o,loading:h,toggleInterest:x}=pe(a,s,r,t);return u?.id===r?o>0?e.jsx(we,{postId:a,postType:s,postTitle:t,interestCount:o,children:e.jsxs(g,{variant:"outline",size:"sm",className:`flex items-center gap-2 ${c}`,children:[e.jsx(M,{className:"h-4 w-4"}),e.jsxs("span",{children:[o," interested"]})]})}):e.jsxs("div",{className:`flex items-center gap-2 ${c}`,children:[e.jsx(L,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(I,{variant:"secondary",className:"text-xs",children:"No interest yet"})]}):d==="compact"?e.jsxs(g,{variant:i?"default":"outline",size:"sm",onClick:x,disabled:h,className:`flex items-center gap-1 ${c}`,children:[h?e.jsx(R,{className:"h-3 w-3 animate-spin"}):e.jsx(L,{className:`h-3 w-3 ${i?"fill-current":""}`}),o>0&&e.jsx("span",{className:"text-xs",children:o})]}):e.jsxs(g,{variant:i?"default":"outline",size:"sm",onClick:x,disabled:h,className:`flex items-center gap-2 ${c}`,children:[h?e.jsx(R,{className:"h-4 w-4 animate-spin"}):e.jsx(L,{className:`h-4 w-4 ${i?"fill-current":""}`}),e.jsx("span",{children:i?"Interested":"Interested?"}),o>0&&e.jsx(I,{variant:"secondary",className:"text-xs",children:o})]})},ye=({open:a,onOpenChange:s,recipientId:r,recipientName:t,recipientAvatar:d,postId:c,postType:u,postTitle:i})=>{const{user:o}=P(),{toast:h}=Q(),x=T(),{sendMessage:N,sending:m}=xe(),[l,n]=p.useState(""),[f,v]=p.useState(i?`Re: ${i}`:""),w=async()=>{if(!(!l.trim()||!o))try{(await N({recipient_id:r,subject:f.trim()||"Message",content:l.trim(),post_id:c,post_type:u,post_title:i})).success&&(n(""),v(i?`Re: ${i}`:""),s(!1),h({title:"Message sent!",description:`Your message has been sent to ${t}.`,action:e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>x("/messages"),className:"flex items-center gap-1",children:[e.jsx(de,{className:"h-3 w-3"}),"View Messages"]})}))}catch(j){console.error("Error sending message:",j),h({title:"Error",description:"Failed to send message. Please try again.",variant:"destructive"})}},_=()=>{const j=`@${t} `;n(C=>C+j)},b=j=>{j.key==="Enter"&&(j.ctrlKey||j.metaKey)&&(j.preventDefault(),w())};return e.jsx(U,{open:a,onOpenChange:s,children:e.jsxs(V,{className:"sm:max-w-[500px]",children:[e.jsxs(B,{children:[e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Send Message"]}),e.jsxs(Z,{children:["Send a message to ",t,i&&` about "${i}"`]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted rounded-lg",children:[e.jsxs(D,{className:"h-10 w-10",children:[e.jsx($,{src:d||void 0}),e.jsx(E,{children:e.jsx(q,{className:"h-5 w-5"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Recipient"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"subject",children:"Subject"}),e.jsx(oe,{id:"subject",value:f,onChange:j=>v(j.target.value),placeholder:"Enter subject...",onKeyDown:b})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(J,{htmlFor:"message",children:"Message"}),e.jsx(g,{type:"button",variant:"ghost",size:"sm",onClick:_,className:"text-xs",children:"@mention"})]}),e.jsx(me,{id:"message",value:l,onChange:j=>n(j.target.value),placeholder:"Type your message here...",rows:4,className:"resize-none",onKeyDown:b}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:[l.length,"/1000 characters"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ctrl+Enter to send"})]})]}),i&&e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-950 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsxs("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:["Regarding: ",i]}),e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-1",children:u==="listing"?"Marketplace Listing":"Community Event"})]})]}),e.jsxs(le,{children:[e.jsx(g,{variant:"outline",onClick:()=>s(!1),disabled:m,children:"Cancel"}),e.jsxs(g,{onClick:w,disabled:!l.trim()||m||l.length>1e3,className:"flex items-center gap-2",children:[m?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(ue,{className:"h-4 w-4"}),m?"Sending...":"Send Message"]})]})]})})},Ce=({open:a,onOpenChange:s,profile:r,postInfo:t,onContact:d})=>{const c=r.full_name||r.username||"Anonymous User",u=r.created_at?F(r.created_at):"Recently";return e.jsx(U,{open:a,onOpenChange:s,children:e.jsxs(V,{className:"sm:max-w-[500px]",children:[e.jsxs(B,{children:[e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"User Profile"]}),e.jsx(Z,{children:"View information about this community member"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-muted/50 rounded-lg",children:[e.jsxs(D,{className:"h-16 w-16",children:[e.jsx($,{src:r.avatar_url||void 0}),e.jsx(E,{className:"text-lg",children:c.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold",children:c}),r.username&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["@",r.username]}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(ce,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Joined ",u]})]})]})]}),r.bio&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"About"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.bio})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx(je,{}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center gap-2",children:[t.type==="listing"?e.jsx(fe,{className:"h-4 w-4"}):e.jsx(M,{className:"h-4 w-4"}),t.type==="listing"?"Listing Details":"Event Details"]}),e.jsx("div",{className:"space-y-3 p-3 bg-muted/30 rounded-lg",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.title}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-muted-foreground",children:[e.jsx(I,{variant:"secondary",className:"text-xs",children:t.category}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-3 w-3"}),e.jsx("span",{children:t.location})]}),t.created_at&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"h-3 w-3"}),e.jsx("span",{children:F(t.created_at)})]})]})]})})]})]}),e.jsxs("div",{className:"flex gap-3",children:[d&&e.jsxs(g,{onClick:d,className:"flex-1",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Send Message"]}),e.jsx(g,{variant:"outline",onClick:()=>s(!1),className:"flex-1",children:"Close"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:"12"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Posts"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:"4.8"}),e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center justify-center gap-1",children:[e.jsx(ve,{className:"h-3 w-3 fill-current"}),"Rating"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:"89%"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Response"})]})]})]})]})})},Ve=({id:a,title:s,description:r,location:t,category:d,image:c,price:u,date:i,time:o,timeAgo:h,created_at:x,user_id:N,profiles:m,onEdit:l,onDelete:n,type:f,showActions:v=!0})=>{const{user:w}=P();T();const[_,b]=p.useState(!1),[j,C]=p.useState(!1),A=w?.id===N,K=m?.full_name||m?.username||"Anonymous",Y=m?.avatar_url,G=()=>{C(!0)},te=()=>{b(!0)},ae=()=>{C(!1),b(!0)},O=()=>h||(x?F(x):i&&o?`${i} at ${o}`:null);return e.jsxs(W,{className:"overflow-hidden hover:shadow-lg transition-shadow duration-200",children:[c&&e.jsx("div",{className:"aspect-video overflow-hidden",children:e.jsx("img",{src:c,alt:s,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-200"})}),e.jsxs(X,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx(I,{variant:f==="listing"?"default":"secondary",children:d}),u&&e.jsxs("span",{className:"text-lg font-bold text-primary",children:["$",u.toFixed(2)]})]}),e.jsx("h3",{className:"font-semibold text-lg mb-2 line-clamp-2",children:s}),e.jsx("p",{className:"text-muted-foreground text-sm mb-3 line-clamp-3",children:r}),e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{children:t})]}),O()&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx("span",{children:O()})]})]}),v&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(be,{postId:a,postType:f,postOwnerId:N,postTitle:s,variant:"default",className:"flex-1"}),!A&&e.jsxs(g,{variant:"outline",size:"sm",onClick:te,className:"flex items-center gap-1 hover:bg-green-50 hover:text-green-700 hover:border-green-300 transition-colors",children:[e.jsx(z,{className:"h-4 w-4"}),"Contact"]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(g,{variant:"outline",size:"sm",onClick:G,className:"flex-1 flex items-center justify-center gap-1 hover:bg-blue-50 hover:text-blue-700 hover:border-blue-300 transition-colors",children:[e.jsx(ge,{className:"h-4 w-4"}),"View Profile"]})})]})]}),e.jsxs(re,{className:"p-4 pt-0 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:opacity-80 transition-opacity",onClick:G,children:[e.jsxs(D,{className:"h-8 w-8",children:[e.jsx($,{src:Y||void 0}),e.jsx(E,{children:e.jsx(q,{className:"h-4 w-4"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:K}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",m?.username||"anonymous"]})]})]}),A&&(l||n)&&e.jsxs("div",{className:"flex gap-2",children:[l&&e.jsx(g,{variant:"outline",size:"sm",onClick:()=>l(a),className:"hover:bg-blue-50 hover:text-blue-700 hover:border-blue-300 transition-colors",children:e.jsx(Ne,{className:"h-4 w-4"})}),n&&e.jsx(g,{variant:"outline",size:"sm",onClick:()=>n(a),className:"text-destructive hover:text-destructive hover:bg-red-50 hover:border-red-300 transition-colors",children:e.jsx(he,{className:"h-4 w-4"})})]})]}),e.jsx(ye,{open:_,onOpenChange:b,recipientId:N,recipientName:K,recipientAvatar:Y,postId:a,postType:f,postTitle:s}),e.jsx(Ce,{open:j,onOpenChange:C,profile:{id:m?.id||N,username:m?.username||null,full_name:m?.full_name||null,avatar_url:m?.avatar_url||null,bio:m?.bio||null,created_at:m?.created_at,email:m?.email||null},postInfo:{id:a,title:s,type:f,category:d,location:t,created_at:x},onContact:A?void 0:ae})]})};export{Ue as G,Ve as P};
