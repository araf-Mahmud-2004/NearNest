import{j as e}from"./ui-JykPZCXU.js";import{r as o,R as le}from"./vendor-o8UMtg5z.js";import{l as de,m as ue,o as he,p as fe,C as me,N as pe,D as xe,g as ge,i as we,j as ye,k as ve}from"./Navbar-DN0c9AM8.js";import{B as N,I as $}from"./input-Y27Ukfeg.js";import{c as T,f as V,a as U,A as be}from"./index-Xla51Co3.js";import{L as C}from"./label-B4bWfWXI.js";import{C as k,b as P,c as E,a as D}from"./card-D3n9XfdJ.js";import"./router-CRfqy20j.js";import"./supabase-DllsxF6L.js";import"./utils-Bsf8JV-l.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=T("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=T("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=T("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=T("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);function Ce(){const{theme:t,setTheme:s,actualTheme:r}=V(),c=[{value:"light",label:"Light",icon:R},{value:"dark",label:"Dark",icon:F},{value:"system",label:"System",icon:Z}],n=c.find(i=>i.value===t),a=n?.icon||R;return e.jsxs(de,{children:[e.jsx(ue,{asChild:!0,children:e.jsxs(N,{variant:"outline",size:"sm",className:"w-auto px-3 py-2",children:[e.jsx(a,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:n?.label}),e.jsx("span",{className:"sm:hidden",children:r==="dark"?"ðŸŒ™":"â˜€ï¸"})]})}),e.jsx(he,{align:"end",className:"w-48",children:c.map(i=>{const l=i.icon;return e.jsxs(fe,{onClick:()=>s(i.value),className:"flex items-center justify-between cursor-pointer",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(l,{className:"h-4 w-4 mr-2"}),i.label]}),t===i.value&&e.jsx(me,{className:"h-4 w-4"})]},i.value)})})]})}function Ne(t,s,{checkForDefaultPrevented:r=!0}={}){return function(n){if(t?.(n),r===!1||!n.defaultPrevented)return s?.(n)}}function W(t,s){if(typeof t=="function")return t(s);t!=null&&(t.current=s)}function G(...t){return s=>{let r=!1;const c=t.map(n=>{const a=W(n,s);return!r&&typeof a=="function"&&(r=!0),a});if(r)return()=>{for(let n=0;n<c.length;n++){const a=c[n];typeof a=="function"?a():W(t[n],null)}}}}function J(...t){return o.useCallback(G(...t),t)}function Se(t,s=[]){let r=[];function c(a,i){const l=o.createContext(i),d=r.length;r=[...r,i];const u=f=>{const{scope:x,children:p,...g}=f,w=x?.[t]?.[d]||l,v=o.useMemo(()=>g,Object.values(g));return e.jsx(w.Provider,{value:v,children:p})};u.displayName=a+"Provider";function h(f,x){const p=x?.[t]?.[d]||l,g=o.useContext(p);if(g)return g;if(i!==void 0)return i;throw new Error(`\`${f}\` must be used within \`${a}\``)}return[u,h]}const n=()=>{const a=r.map(i=>o.createContext(i));return function(l){const d=l?.[t]||a;return o.useMemo(()=>({[`__scope${t}`]:{...l,[t]:d}}),[l,d])}};return n.scopeName=t,[c,ke(n,...s)]}function ke(...t){const s=t[0];if(t.length===1)return s;const r=()=>{const c=t.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(a){const i=c.reduce((l,{useScope:d,scopeName:u})=>{const f=d(a)[`__scope${u}`];return{...l,...f}},{});return o.useMemo(()=>({[`__scope${s.scopeName}`]:i}),[i])}};return r.scopeName=s.scopeName,r}var K=globalThis?.document?o.useLayoutEffect:()=>{},Pe=le[" useInsertionEffect ".trim().toString()]||K;function Ee({prop:t,defaultProp:s,onChange:r=()=>{},caller:c}){const[n,a,i]=De({defaultProp:s,onChange:r}),l=t!==void 0,d=l?t:n;{const h=o.useRef(t!==void 0);o.useEffect(()=>{const f=h.current;f!==l&&console.warn(`${c} is changing from ${f?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),h.current=l},[l,c])}const u=o.useCallback(h=>{if(l){const f=Re(h)?h(t):h;f!==t&&i.current?.(f)}else a(h)},[l,t,a,i]);return[d,u]}function De({defaultProp:t,onChange:s}){const[r,c]=o.useState(t),n=o.useRef(r),a=o.useRef(s);return Pe(()=>{a.current=s},[s]),o.useEffect(()=>{n.current!==r&&(a.current?.(r),n.current=r)},[r,n]),[r,c,a]}function Re(t){return typeof t=="function"}function Te(t){const s=o.useRef({value:t,previous:t});return o.useMemo(()=>(s.current.value!==t&&(s.current.previous=s.current.value,s.current.value=t),s.current.previous),[t])}function Ae(t){const[s,r]=o.useState(void 0);return K(()=>{if(t){r({width:t.offsetWidth,height:t.offsetHeight});const c=new ResizeObserver(n=>{if(!Array.isArray(n)||!n.length)return;const a=n[0];let i,l;if("borderBoxSize"in a){const d=a.borderBoxSize,u=Array.isArray(d)?d[0]:d;i=u.inlineSize,l=u.blockSize}else i=t.offsetWidth,l=t.offsetHeight;r({width:i,height:l})});return c.observe(t,{box:"border-box"}),()=>c.unobserve(t)}else r(void 0)},[t]),s}function Me(t){const s=_e(t),r=o.forwardRef((c,n)=>{const{children:a,...i}=c,l=o.Children.toArray(a),d=l.find(Le);if(d){const u=d.props.children,h=l.map(f=>f===d?o.Children.count(u)>1?o.Children.only(null):o.isValidElement(u)?u.props.children:null:f);return e.jsx(s,{...i,ref:n,children:o.isValidElement(u)?o.cloneElement(u,void 0,h):null})}return e.jsx(s,{...i,ref:n,children:a})});return r.displayName=`${t}.Slot`,r}function _e(t){const s=o.forwardRef((r,c)=>{const{children:n,...a}=r;if(o.isValidElement(n)){const i=$e(n),l=ze(a,n.props);return n.type!==o.Fragment&&(l.ref=c?G(c,i):i),o.cloneElement(n,l)}return o.Children.count(n)>1?o.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var Ie=Symbol("radix.slottable");function Le(t){return o.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Ie}function ze(t,s){const r={...s};for(const c in s){const n=t[c],a=s[c];/^on[A-Z]/.test(c)?n&&a?r[c]=(...l)=>{const d=a(...l);return n(...l),d}:n&&(r[c]=n):c==="style"?r[c]={...n,...a}:c==="className"&&(r[c]=[n,a].filter(Boolean).join(" "))}return{...t,...r}}function $e(t){let s=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=s&&"isReactWarning"in s&&s.isReactWarning;return r?t.ref:(s=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=s&&"isReactWarning"in s&&s.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var Fe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Q=Fe.reduce((t,s)=>{const r=Me(`Primitive.${s}`),c=o.forwardRef((n,a)=>{const{asChild:i,...l}=n,d=i?r:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(d,{...l,ref:a})});return c.displayName=`Primitive.${s}`,{...t,[s]:c}},{}),A="Switch",[Be,tt]=Se(A),[Oe,He]=Be(A),X=o.forwardRef((t,s)=>{const{__scopeSwitch:r,name:c,checked:n,defaultChecked:a,required:i,disabled:l,value:d="on",onCheckedChange:u,form:h,...f}=t,[x,p]=o.useState(null),g=J(s,j=>p(j)),w=o.useRef(!1),v=x?h||!!x.closest("form"):!0,[b,M]=Ee({prop:n,defaultProp:a??!1,onChange:u,caller:A});return e.jsxs(Oe,{scope:r,checked:b,disabled:l,children:[e.jsx(Q.button,{type:"button",role:"switch","aria-checked":b,"aria-required":i,"data-state":se(b),"data-disabled":l?"":void 0,disabled:l,value:d,...f,ref:g,onClick:Ne(t.onClick,j=>{M(_=>!_),v&&(w.current=j.isPropagationStopped(),w.current||j.stopPropagation())})}),v&&e.jsx(te,{control:x,bubbles:!w.current,name:c,value:d,checked:b,required:i,disabled:l,form:h,style:{transform:"translateX(-100%)"}})]})});X.displayName=A;var Y="SwitchThumb",ee=o.forwardRef((t,s)=>{const{__scopeSwitch:r,...c}=t,n=He(Y,r);return e.jsx(Q.span,{"data-state":se(n.checked),"data-disabled":n.disabled?"":void 0,...c,ref:s})});ee.displayName=Y;var qe="SwitchBubbleInput",te=o.forwardRef(({__scopeSwitch:t,control:s,checked:r,bubbles:c=!0,...n},a)=>{const i=o.useRef(null),l=J(i,a),d=Te(r),u=Ae(s);return o.useEffect(()=>{const h=i.current;if(!h)return;const f=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(f,"checked").set;if(d!==r&&p){const g=new Event("click",{bubbles:c});p.call(h,r),h.dispatchEvent(g)}},[d,r,c]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...n,tabIndex:-1,ref:l,style:{...n.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});te.displayName=qe;function se(t){return t?"checked":"unchecked"}var re=X,Ue=ee;const B=o.forwardRef(({className:t,...s},r)=>e.jsx(re,{className:U("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...s,ref:r,children:e.jsx(Ue,{className:U("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));B.displayName=re.displayName;const st=()=>{const{user:t,changePassword:s,signOut:r}=o.useContext(be)||{},{theme:c,setTheme:n,actualTheme:a}=V(),[i,l]=o.useState(""),[d,u]=o.useState(""),[h,f]=o.useState(""),[x,p]=o.useState(""),[g,w]=o.useState(""),[v,b]=o.useState(!1),[M,j]=o.useState(!0),[_,ne]=o.useState(!1),[oe,S]=o.useState(!1),[I,O]=o.useState(!1),[L,z]=o.useState(""),ce=async m=>{if(m.preventDefault(),p(""),w(""),d!==h){p("New passwords do not match.");return}if(d.length<6){p("New password must be at least 6 characters long.");return}b(!0);try{s?(await s(i,d),w("Password changed successfully."),l(""),u(""),f("")):p("Password change function not available.")}catch(y){console.error("Password change error:",y),p(y.message||"Failed to change password.")}finally{b(!1)}},ae=async()=>{z(""),O(!0);try{if(!t?.id)throw new Error("User not found. Please log in again.");console.log("Attempting to delete account for user:",t.id);let m;try{m=await fetch("http://localhost:4000/health",{method:"GET",headers:{"Content-Type":"application/json"}})}catch{throw new Error("Cannot connect to deletion service. Please make sure the backend server is running on port 4000.")}if(!m.ok)throw new Error("Deletion service is not responding properly. Please try again later.");const y=await fetch("http://localhost:4000/delete-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:t.id})});if(!y.ok){const q=await y.json();throw new Error(q.error||"Failed to delete account.")}const H=await y.json();if(console.log("Account deletion successful:",H),!H.success)throw new Error("Account deletion was not completed successfully.");r&&await r(),z(""),S(!1),alert("Your account has been deleted successfully. Thank you for using NearNest."),localStorage.clear(),sessionStorage.clear(),window.location.href="/auth"}catch(m){console.error("Delete account error:",m),z(m.message||"Failed to delete account. Please try again later.")}finally{O(!1)}},ie=[{value:"light",label:"Light",icon:R,description:"Light mode"},{value:"dark",label:"Dark",icon:F,description:"Dark mode"},{value:"system",label:"System",icon:Z,description:"Follow system preference"}];return e.jsxs("div",{className:"min-h-screen bg-background text-foreground",children:[e.jsx(pe,{}),e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-10",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Settings"}),e.jsxs(k,{className:"mb-8",children:[e.jsx(P,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5"}),"Appearance"]})}),e.jsxs(D,{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[a==="dark"?e.jsx(F,{className:"h-5 w-5"}):e.jsx(R,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Currently using ",a," mode"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c==="system"?"Following system preference":`Manually set to ${c}`})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(C,{className:"text-base font-medium",children:"Choose Theme"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:ie.map(m=>{const y=m.icon;return e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border cursor-pointer transition-colors ${c===m.value?"border-primary bg-primary/5":"border-border hover:bg-muted/50"}`,onClick:()=>n(m.value),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:m.label}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m.description})]})]}),e.jsx("div",{className:`w-4 h-4 rounded-full border-2 ${c===m.value?"border-primary bg-primary":"border-muted-foreground"}`})]},m.value)})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Quick Toggle"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use the dropdown for more options"})]}),e.jsx(Ce,{})]})]})]}),e.jsxs(k,{className:"mb-8",children:[e.jsx(P,{children:e.jsx(E,{children:"Change Password"})}),e.jsx(D,{children:e.jsxs("form",{onSubmit:ce,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"current-password",children:"Current Password"}),e.jsx($,{id:"current-password",type:"password",value:i,onChange:m=>l(m.target.value),className:"mt-1",required:!0,minLength:6})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"new-password",children:"New Password"}),e.jsx($,{id:"new-password",type:"password",value:d,onChange:m=>u(m.target.value),className:"mt-1",required:!0,minLength:6})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"confirm-password",children:"Confirm New Password"}),e.jsx($,{id:"confirm-password",type:"password",value:h,onChange:m=>f(m.target.value),className:"mt-1",required:!0,minLength:6})]}),x&&e.jsx("div",{className:"text-red-500 text-sm",children:x}),g&&e.jsx("div",{className:"text-green-600 text-sm",children:g}),e.jsx(N,{type:"submit",className:"w-full mt-2",disabled:v,children:v?"Changing...":"Change Password"})]})})]}),e.jsxs(k,{className:"mb-8",children:[e.jsx(P,{children:e.jsx(E,{children:"Notification Preferences"})}),e.jsx(D,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(C,{htmlFor:"email-notif",children:"Email Notifications"}),e.jsx(B,{id:"email-notif",checked:M,onCheckedChange:j})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(C,{htmlFor:"push-notif",children:"Push Notifications"}),e.jsx(B,{id:"push-notif",checked:_,onCheckedChange:ne})]})]})})]}),e.jsxs(k,{className:"border-destructive/50",children:[e.jsx(P,{children:e.jsx(E,{className:"text-destructive",children:"Delete Account"})}),e.jsxs(D,{children:[e.jsx("p",{className:"mb-4 text-sm text-muted-foreground",children:"This action is irreversible. All your data will be permanently deleted."}),e.jsx(N,{variant:"destructive",className:"w-full",onClick:()=>S(!0),children:"Delete Account"})]})]}),e.jsx(xe,{open:oe,onOpenChange:S,children:e.jsxs(ge,{children:[e.jsx(we,{children:"Confirm Account Deletion"}),e.jsx(ye,{children:"Are you sure you want to delete your account? This action cannot be undone. All your data, including listings and profile information, will be permanently removed."}),L&&e.jsxs("div",{className:"text-red-500 text-sm mb-2 p-3 bg-red-50 dark:bg-red-900/20 rounded",children:[e.jsx("strong",{children:"Error:"})," ",L,L.includes("backend server")&&e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsx("strong",{children:"To fix this:"}),e.jsx("br",{}),"1. Open a terminal in your project folder",e.jsx("br",{}),"2. Run: ",e.jsx("code",{children:"node backend/deleteUser.cjs"}),e.jsx("br",{}),"3. Keep the terminal open and try again"]})]}),e.jsxs(ve,{children:[e.jsx(N,{variant:"ghost",onClick:()=>S(!1),disabled:I,children:"Cancel"}),e.jsx(N,{variant:"destructive",onClick:ae,disabled:I,children:I?"Deleting...":"Delete Account"})]})]})})]})]})};export{st as default};
