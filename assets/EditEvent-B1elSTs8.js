import{j as e}from"./ui-JykPZCXU.js";import{r as d}from"./vendor-o8UMtg5z.js";import{B as u,I as p}from"./input-DSoQLqVb.js";import{C as U,b as P,c as F,a as L}from"./card-BPC4h2rA.js";import{T}from"./textarea-BQPmEDNz.js";import{S as A,a as B,b as R,c as G,d as M}from"./select-pn3VTHQQ.js";import{N as y,e as N}from"./Navbar-DXhC-Htt.js";import{u as V,d as _,X as q,e as b}from"./index-DOD6g3cj.js";import{a as z,c as H}from"./router-DZ6VJzti.js";import{A as J}from"./arrow-left-ZkvyHdYd.js";import{U as W}from"./upload-_j9l7ye0.js";import"./index-BdQq_4o_.js";import"./supabase-DllsxF6L.js";import"./utils-Bsf8JV-l.js";const oe=()=>{const n=z(),{id:c}=H(),{toast:i}=V(),{updateEvent:E}=_(),[C,h]=d.useState(!0),[g,f]=d.useState(!1),[a,j]=d.useState({title:"",description:"",date:"",time:"",location:"",category:""}),[x,v]=d.useState([]),S=["Community Service","Market","Education","Social","Workshop","Fitness"];d.useEffect(()=>{(async()=>{if(!c){i({title:"Error",description:"No event ID provided",variant:"destructive"}),n("/events");return}try{h(!0);const{data:s}=await b.getEvents(),r=s?.find(m=>m.id===c);if(!r){i({title:"Error",description:"Event not found",variant:"destructive"}),n("/events");return}const{data:l}=await b.getCurrentUserProfile();if(r.user_id!==l?.id){i({title:"Error",description:"You can only edit your own events",variant:"destructive"}),n("/events");return}j({title:r.title,description:r.description,date:r.date,time:r.time,location:r.location,category:r.category}),r.image&&v([r.image])}catch(s){console.error("Error loading event:",s),i({title:"Error",description:"Failed to load event",variant:"destructive"}),n("/events")}finally{h(!1)}})()},[c,n,i]);const o=(t,s)=>{j(r=>({...r,[t]:s}))},w=t=>{const s=t.target.files;s&&Array.from(s).forEach(r=>{const l=new FileReader;l.onload=m=>{m.target?.result&&v(I=>[...I,m.target.result])},l.readAsDataURL(r)})},D=t=>{v(s=>s.filter((r,l)=>l!==t))},k=async t=>{if(t.preventDefault(),!a.title||!a.description||!a.date||!a.time||!a.category){i({title:"Error",description:"Please fill in all required fields.",variant:"destructive"});return}if(!c){i({title:"Error",description:"No event ID provided",variant:"destructive"});return}try{f(!0),await E(c,{title:a.title,description:a.description,date:a.date,time:a.time,location:a.location||"Local Area",category:a.category,image:x[0]||null}),i({title:"Success",description:"Event updated successfully"}),n("/events")}catch(s){console.error("Error updating event:",s),i({title:"Error",description:"Failed to update event",variant:"destructive"})}finally{f(!1)}};return C?e.jsxs("div",{className:"min-h-screen bg-background text-foreground",children:[e.jsx(y,{}),e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(N,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading event..."})]})]}):e.jsxs("div",{className:"min-h-screen bg-background text-foreground",children:[e.jsx(y,{}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8 animate-fade-in",children:[e.jsxs(u,{variant:"ghost",onClick:()=>n(-1),className:"mb-4 hover:bg-gray-100",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Edit Event"}),e.jsx("p",{className:"text-muted-foreground",children:"Update your event details"})]}),e.jsxs(U,{className:"border-0 shadow-md animate-fade-in",style:{animationDelay:"0.1s"},children:[e.jsx(P,{children:e.jsx(F,{children:"Event Details"})}),e.jsx(L,{children:e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Event Title *"}),e.jsx(p,{placeholder:"Enter event title",value:a.title,onChange:t=>o("title",t.target.value),className:"transition-all duration-200 focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Category *"}),e.jsxs(A,{value:a.category,onValueChange:t=>o("category",t),children:[e.jsx(B,{className:"transition-all duration-200 focus:ring-2 focus:ring-primary",children:e.jsx(R,{placeholder:"Select category"})}),e.jsx(G,{children:S.map(t=>e.jsx(M,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Date *"}),e.jsx(p,{type:"date",value:a.date,onChange:t=>o("date",t.target.value),className:"transition-all duration-200 focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Time *"}),e.jsx(p,{type:"time",value:a.time,onChange:t=>o("time",t.target.value),className:"transition-all duration-200 focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Location"}),e.jsx(p,{placeholder:"Enter event location",value:a.location,onChange:t=>o("location",t.target.value),className:"transition-all duration-200 focus:ring-2 focus:ring-primary"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Description *"}),e.jsx(T,{placeholder:"Describe your event in detail...",value:a.description,onChange:t=>o("description",t.target.value),className:"min-h-32 transition-all duration-200 focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Event Photo"}),e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center hover:border-primary transition-colors duration-200",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:w,className:"hidden",id:"image-upload"}),e.jsxs("label",{htmlFor:"image-upload",className:"cursor-pointer",children:[e.jsx(W,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Click to upload photos"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"PNG, JPG up to 10MB"})]})]}),x.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:x.map((t,s)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t,alt:`Upload ${s+1}`,className:"w-full h-24 object-cover rounded-lg"}),e.jsx(u,{type:"button",variant:"destructive",size:"sm",className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200 p-1 h-6 w-6",onClick:()=>D(s),children:e.jsx(q,{className:"h-3 w-3"})})]},s))})]}),e.jsxs("div",{className:"flex space-x-4 pt-6",children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>n(-1),className:"flex-1",disabled:g,children:"Cancel"}),e.jsx(u,{type:"submit",className:"flex-1 bg-primary hover:bg-accent text-primary-foreground",disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-4 w-4 mr-2 animate-spin"}),"Updating..."]}):"Update Event"})]})]})})]})]})]})};export{oe as default};
